<Window x:Class="Studio_Rent_Service.Pages.Reservation_Control"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:Studio_Rent_Service.Pages"
        mc:Ignorable="d"
        Title="Reservation_Control" Height="700" Width="1200"
        MinHeight="500" MinWidth="800">
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Заголовок -->
        <Border Grid.Row="0" Background="#2c3e50" Padding="15">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <TextBlock Text="📅 Управление бронированиями" 
                          Foreground="White" 
                          FontSize="22" 
                          FontWeight="Bold"/>

                <StackPanel Grid.Column="1" Orientation="Horizontal">
                    <Button x:Name="btnGenerateReport" 
                           Content="📊 Отчет" 
                           Background="#8e44ad" 
                           Foreground="White"
                           Margin="5,0"
                           Padding="12,5"
                           Click="BtnGenerateReport_Click"
                           ToolTip="Сформировать отчет по бронированиям"/>
                    <Button x:Name="btnCheckAvailability" 
                           Content="✅ Проверить доступность" 
                           Background="#16a085" 
                           Foreground="White"
                           Margin="5,0"
                           Padding="12,5"
                           Click="BtnCheckAvailability_Click"
                           ToolTip="Проверить доступность студии"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Основное содержимое -->
        <Grid Grid.Row="1" Margin="10">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="2*" MinWidth="400"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="3*" MinWidth="500"/>
            </Grid.ColumnDefinitions>

            <!-- Левая панель - Форма ввода -->
            <Border Grid.Column="0" 
                   Margin="0,0,10,0" 
                   BorderBrush="#bdc3c7" 
                   BorderThickness="1"
                   CornerRadius="5"
                   Padding="15"
                   Background="#f8f9fa">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel>
                        <TextBlock Text="Данные бронирования" 
                                  FontSize="18" 
                                  FontWeight="Bold" 
                                  Margin="0,0,0,15"
                                  Foreground="#2c3e50"/>

                        <!-- Код бронирования -->
                        <Grid Margin="0,0,0,10">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto" MinWidth="160"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock Text="Код бронирования:" Grid.Column="0"/>
                            <TextBox x:Name="txtCode" Grid.Column="1" 
                                    IsReadOnly="True"
                                    Background="#ecf0f1"/>
                        </Grid>

                        <!-- Дата бронирования -->
                        <Grid Margin="0,0,0,10">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto" MinWidth="160"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock Text="Дата бронирования:" Grid.Column="0"/>
                            <DatePicker x:Name="dpBookingDate" Grid.Column="1"
                            />
                        </Grid>

                        <!-- Время начала -->
                        <Grid Margin="0,0,0,10">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto" MinWidth="160"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock Text="Время начала:" Grid.Column="0"/>
                            <ComboBox x:Name="cbStartTime" Grid.Column="1">
                                <ComboBox.Items>
                                    <ComboBoxItem Content="08:00"/>
                                    <ComboBoxItem Content="09:00"/>
                                    <ComboBoxItem Content="10:00"/>
                                    <ComboBoxItem Content="11:00"/>
                                    <ComboBoxItem Content="12:00"/>
                                    <ComboBoxItem Content="13:00"/>
                                    <ComboBoxItem Content="14:00"/>
                                    <ComboBoxItem Content="15:00"/>
                                    <ComboBoxItem Content="16:00"/>
                                    <ComboBoxItem Content="17:00"/>
                                    <ComboBoxItem Content="18:00"/>
                                    <ComboBoxItem Content="19:00"/>
                                    <ComboBoxItem Content="20:00"/>
                                    <ComboBoxItem Content="21:00"/>
                                    <ComboBoxItem Content="22:00"/>
                                </ComboBox.Items>
                            </ComboBox>
                        </Grid>

                        <!-- Продолжительность -->
                        <Grid Margin="0,0,0,10">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto" MinWidth="160"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock Text="Продолжительность:" Grid.Column="0"/>
                            <ComboBox x:Name="cbDuration" Grid.Column="1" SelectedIndex="1">
                                <ComboBox.Items>
                                    <ComboBoxItem Content="1 час" Tag="1"/>
                                    <ComboBoxItem Content="2 часа" Tag="2"/>
                                    <ComboBoxItem Content="3 часа" Tag="3"/>
                                    <ComboBoxItem Content="4 часа" Tag="4"/>
                                    <ComboBoxItem Content="5 часов" Tag="5"/>
                                    <ComboBoxItem Content="6 часов" Tag="6"/>
                                    <ComboBoxItem Content="Весь день (8 часов)" Tag="8"/>
                                </ComboBox.Items>
                            </ComboBox>
                        </Grid>

                        <!-- Студия -->
                        <Grid Margin="0,0,0,10">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto" MinWidth="160"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock Text="Студия:" Grid.Column="0"/>
                            <ComboBox x:Name="cbStudio" Grid.Column="1"
                                     DisplayMemberPath="Name"/>
                        </Grid>

                        <!-- Клиент -->
                        <Grid Margin="0,0,0,10">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto" MinWidth="160"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock Text="Клиент:" Grid.Column="0"/>
                            <ComboBox x:Name="cbClient" Grid.Column="1"
                                     DisplayMemberPath="FullName"/>
                        </Grid>

                        <!-- Статус -->
                        <Grid Margin="0,0,0,10">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto" MinWidth="160"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock Text="Статус:" Grid.Column="0"/>
                            <ComboBox x:Name="cbStatus" Grid.Column="1" SelectedIndex="0">
                                <ComboBox.Items>
                                    <ComboBoxItem Content="Активно"/>
                                    <ComboBoxItem Content="Завершено"/>
                                    <ComboBoxItem Content="Отменено"/>
                                </ComboBox.Items>
                            </ComboBox>
                        </Grid>

                        <!-- Стоимость -->
                        <Grid Margin="0,0,0,10">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto" MinWidth="160"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock Text="Стоимость:" Grid.Column="0"/>
                            <Grid Grid.Column="1">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <TextBox x:Name="txtCost" Grid.Column="0"/>
                                <TextBlock Text="₽" 
                                          Grid.Column="1" 
                                          Margin="10,0,0,0"
                                          VerticalAlignment="Center"/>
                            </Grid>
                        </Grid>

                        <!-- Комментарий -->
                        <Grid Margin="0,0,0,20">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto" MinWidth="160"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock Text="Комментарий:" Grid.Column="0"/>
                            <TextBox x:Name="txtComment" Grid.Column="1" 
                                    Height="60"
                                    MaxLength="500"
                                    TextWrapping="Wrap"
                                    AcceptsReturn="True"
                                    VerticalScrollBarVisibility="Auto"/>
                        </Grid>

                        <!-- Кнопки управления -->
                        <WrapPanel HorizontalAlignment="Center" Margin="0,10,0,0">
                            <Button x:Name="btnAdd" 
                                   Content="➕ Добавить" 
                                   Background="#27ae60" 
                                   Foreground="White"
                                   Click="BtnAdd_Click"
                                   ToolTip="Добавить новое бронирование" Margin="0,0,10,0"/>
                            <Button x:Name="btnUpdate" 
                                   Content="✏️ Обновить" 
                                   Background="#2980b9" 
                                   Foreground="White"
                                   Click="BtnUpdate_Click"
                                   ToolTip="Обновить выбранное бронирование" Margin="0,0,10,0"/>
                            <Button x:Name="btnDelete" 
                                   Content="🗑️ Удалить" 
                                   Background="#c0392b" 
                                   Foreground="White"
                                   Click="BtnDelete_Click"
                                   ToolTip="Удалить выбранное бронирование" Margin="0,0,10,0"/>
                            <Button x:Name="btnClear" 
                                   Content="🗑️ Очистить" 
                                   Background="#7f8c8d" 
                                   Foreground="White"
                                   Click="BtnClear_Click"
                                   ToolTip="Очистить форму"/>
                        </WrapPanel>

                        <!-- Информация о бронировании -->
                        <Border Margin="0,20,0,0" 
                               BorderBrush="#bdc3c7" 
                               BorderThickness="0,1,0,0"
                               Padding="0,10,0,0">
                            <StackPanel>
                                <TextBlock Text="Информация" 
                                          FontWeight="Bold"
                                          Margin="0,0,0,5"/>
                                <Grid>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                    </Grid.RowDefinitions>
                                    <TextBlock x:Name="txtTimeInfo" 
                                              Text="Время: не выбрано"
                                              Grid.Row="0"/>
                                    <TextBlock x:Name="txtCostInfo" 
                                              Text="Стоимость: не рассчитана"
                                              Grid.Row="1"
                                              Margin="0,5,0,0"/>
                                </Grid>
                            </StackPanel>
                        </Border>
                    </StackPanel>
                </ScrollViewer>
            </Border>

            <!-- Разделитель -->
            <GridSplitter Grid.Column="1" 
                         Width="5" 
                         HorizontalAlignment="Center" 
                         VerticalAlignment="Stretch"
                         Background="#bdc3c7"
                         ShowsPreview="True"/>

            <!-- Правая панель - Список бронирований -->
            <Border Grid.Column="2" 
                   BorderBrush="#bdc3c7" 
                   BorderThickness="1"
                   CornerRadius="5"
                   Background="#f8f9fa">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <!-- Панель фильтров -->
                    <Border Grid.Row="0" 
                           Background="#ecf0f1" 
                           CornerRadius="3"
                           Margin="10,10,10,5"
                           Padding="10">
                        <StackPanel>
                            <!-- Поиск и фильтры -->
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>

                                <TextBlock Text="Поиск:" 
                                          Grid.Column="0" 
                                          Margin="0,0,10,0"
                                          VerticalAlignment="Center"/>

                                <TextBox x:Name="txtSearch" 
                                        Grid.Column="1" 
                                        TextChanged="TxtSearch_TextChanged"
                                        ToolTip="Поиск по клиенту или студии"/>

                                <DatePicker x:Name="dpFilterDate" 
                                           Grid.Column="2" 
                                           Margin="10,0,0,0"
                                           Width="150"
                                           SelectedDateChanged="DpFilterDate_SelectedDateChanged"
                                           ToolTip="Фильтр по дате"/>

                                <Button x:Name="btnClearFilters" 
                                       Grid.Column="3" 
                                       Content="✕ Очистить" 
                                       Margin="10,0,0,0"
                                       Padding="10,5"
                                       Click="BtnClearFilters_Click"
                                       ToolTip="Очистить все фильтры"/>
                            </Grid>

                            <!-- Фильтры по статусу -->
                            <WrapPanel Margin="0,10,0,0" HorizontalAlignment="Center">
                                <TextBlock Text="Статус:" 
                                          Margin="0,0,10,0"
                                          VerticalAlignment="Center"/>
                                <RadioButton x:Name="rbFilterAll" 
                                            Content="Все" 
                                            GroupName="StatusFilter"
                                            IsChecked="True"
                                            Margin="5"
                                            Checked="StatusFilter_Checked"/>
                                <RadioButton x:Name="rbFilterActive" 
                                            Content="Активные" 
                                            GroupName="StatusFilter"
                                            Margin="5"
                                            Checked="StatusFilter_Checked"/>
                                <RadioButton x:Name="rbFilterCompleted" 
                                            Content="Завершенные" 
                                            GroupName="StatusFilter"
                                            Margin="5"
                                            Checked="StatusFilter_Checked"/>
                                <RadioButton x:Name="rbFilterCancelled" 
                                            Content="Отмененные" 
                                            GroupName="StatusFilter"
                                            Margin="5"
                                            Checked="StatusFilter_Checked"/>
                            </WrapPanel>
                        </StackPanel>
                    </Border>

                    <!-- DataGrid с бронированиями -->
                    <DataGrid x:Name="dgBookings" 
                             Grid.Row="1" 
                             Margin="10,5,10,10"
                             SelectionChanged="DgBookings_SelectionChanged">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Код" 
                                               Binding="{Binding Code}" 
                                               Width="60"/>
                            <DataGridTextColumn Header="Дата" 
                                               Binding="{Binding BookingDate, StringFormat='{}{0:dd.MM.yyyy}'}" 
                                               Width="90"/>
                            <DataGridTextColumn Header="Время" 
                                               Binding="{Binding TimeInfo}" 
                                               Width="100"/>
                            <DataGridTextColumn Header="Студия" 
                                               Binding="{Binding Studio.Name}" 
                                               Width="120"/>
                            <DataGridTextColumn Header="Клиент" 
                                               Binding="{Binding Client.FullName}" 
                                               Width="150"/>
                            <DataGridTextColumn Header="Статус" 
                                               Binding="{Binding Status}">
                                <DataGridTextColumn.ElementStyle>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="HorizontalAlignment" Value="Center"/>
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding Status}" Value="Активно">
                                                <Setter Property="Foreground" Value="#27ae60"/>
                                                <Setter Property="FontWeight" Value="Bold"/>
                                            </DataTrigger>
                                            <DataTrigger Binding="{Binding Status}" Value="Завершено">
                                                <Setter Property="Foreground" Value="#7f8c8d"/>
                                            </DataTrigger>
                                            <DataTrigger Binding="{Binding Status}" Value="Отменено">
                                                <Setter Property="Foreground" Value="#c0392b"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </DataGridTextColumn.ElementStyle>
                            </DataGridTextColumn>
                            <DataGridTextColumn Header="Стоимость" 
                                               Binding="{Binding Cost, StringFormat='{}{0:N0} ₽'}" 
                                               Width="100"/>
                            <DataGridTemplateColumn Header="Действия" Width="120">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                            <Button Content="✅" 
                                                   Margin="2"
                                                   Padding="8,4"
                                                   FontSize="12"
                                                   Click="BtnComplete_Click"
                                                   Tag="{Binding Code}"
                                                   ToolTip="Завершить бронирование"
                                                   />
                                            <Button Content="❌" 
                                                   Margin="2"
                                                   Padding="8,4"
                                                   FontSize="12"
                                                   Click="BtnCancel_Click"
                                                   Tag="{Binding Code}"
                                                   ToolTip="Отменить бронирование"
                                                   />
                                            <Button Content="👁️" 
                                                   Margin="2"
                                                   Padding="8,4"
                                                   FontSize="12"
                                                   Click="BtnView_Click"
                                                   Tag="{Binding Code}"
                                                   ToolTip="Просмотреть детали"/>
                                        </StackPanel>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>
                        </DataGrid.Columns>
                    </DataGrid>
                </Grid>
            </Border>
        </Grid>

        <!-- Статус бар -->
        <StatusBar Grid.Row="2" Background="#ecf0f1">
            <StatusBarItem>
                <TextBlock x:Name="txtStatus" Text="Готово"/>
            </StatusBarItem>
            <Separator/>
            <StatusBarItem>
                <TextBlock x:Name="txtFilterInfo" Text="Показаны все бронирования"/>
            </StatusBarItem>
            <Separator/>
            <StatusBarItem HorizontalAlignment="Right">
                <TextBlock Text="{Binding ElementName=dgBookings, Path=Items.Count, StringFormat='Найдено: {0}'}"/>
            </StatusBarItem>
        </StatusBar>
    </Grid>
</Window>
